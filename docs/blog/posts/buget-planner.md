---
draft: true
date: 2024-10-19
---

# 가계부 전략을 웹 서비스로 바꿔보기

본인은 독특한 가계부를 쓰는 습관이 있다.
어디서 배운게 아니고 스스로 고안해낸 방법을 쓴다.

아주 짧게 설명하자면, 개인의 '일상 지출' 따위에 '모든 거래 내역' 을 추적할 가치가 없다.
그러니 내역을 추적하지 않아도 되는 지출 관리 전략이 필요하다.

월에 있었던, 모든 거래내역을 추적하기 위해 얼마의 시간을 써야 하는가? 예컨데 4시간이라 해보자.
500명 급 회사의 예산을 관리할 전문 인력의 월 4시간은 비용 효율적인 선택이다. 그러지 않았을 때의 손실을 생각해보면 합리적인 선택이다.
2~4명 일반 가정의 예산을 관리하기 위해 비 전문가의 월 4시간은 비용 효율적이지 않다. 비 전문가라 정확하지도 않을 것이고, 하지 않는다고 해서 큰일이나거나 즉시 손해로 이어지거나 하지도 않는다.
그 시간에 휴식을 취하고, 본업에 충실하는게 더 유리할지도 모른다.

... 등등 꽤 오래동안 이유를 붙이고 있는 방법이 있다. 왜 하는지에 대해 전부 풀어낼려면 글이 너무 길어지니 이에 대해선 다음 기회에 다루겠다.

내 방법의 핵심 아이디어는, 지출 목적에 따라 결제 수단을 구분하고, 결제 수단 마다 고유한 지불 계좌를 두며, 지불 계좌에 충분한 여유(buffer) 를 두자는 것 이다.
그렇게 해둔다면, 지불 계좌의 잔액만 보고 현 재무 상태가 건전한지 판단 할 수 있다. 그리고 이 판을 유지하기 위해 해야 할 것도 계좌의 잔액을 조정하는 것 뿐이다.
만일 계획한 여유보다 더 여유가 발생한다? 매우 공격적인 투자를 해도 된다. 전부 날려도 내 인생에 문제 없다.
만일 계획한 여유를 만들어내지 못 했다? 유예기간 동안 만회하면 되겠다. 

하여간, 이를 현재는 매달 스프레드시트에 적어가면서 하고 있다. airflow dag 로 표현 할 수 있지 않을까...?
이런짓을 하는 이유는 기껏 rust 로 airflow scheulder 를 재작성해도, dog food 할게 없으면 잘 만들었는지 확인이 어렵기 때문이다.

사설이 길었고, 이제 무엇이 필요한지 따져보자.

## 확인 버튼

본인이 토스 경영진도 아니고... 이체까지 대신해줄 순 없다. 이체를 안내하고, 완수 했음을 받아내야 한다.
챗봇이 되는게 제일 편리할 것 같긴 한데... 당장은 mark success 버튼에 의지하자.

xcom 을 쓰게 될 것 같군

## 계좌, 결제 수단, 버퍼 규칙 등의 표현?

일단은 variables 에... 더 나은 store 가 있을것 같으나 운영이 쉬웠으면 함.

## airflow 에 의존하지 않을 것?

위의 2개를 생각해보니 전부 airflow 내의 기능으로 만들 생각을 하고 있다. 그렇지 않을게 있나?
지금으로서는 없는 듯 함

## pydantic 
pydantic 으로 만들면 편할 것 같은 내용이 있어서... 좀 찾아봄 다음의 사실을 알게 됨

- pydantic_core 는 rust 로 작성되었으나, crate.io 에 올라가 있지 않고, rust 용 인터페이스도 만들어 두지 않았음. pyo3 를 통해 오직 python 만 타겟하여 작성됨
- pydantic_settings 에서, CLI 기능이 쓸만해짐. typer 굳이 필요 없음
    - 그러나 fastapi[standard] 가 fastapi-cli 를 가지고 있고, 이것이 typer 를 가지고 있으므로 fastapi 쓰는데 디펜던시 절감이 목적이라면... 굳이 뺄 필요 없기도 함
    - 개발 복잡도를 줄인다는 면에서는 typer 거부하고 pydantic 으로 하는 것이 쓸만해보임.
- pydantic 은 100% sync 이나, async 한 validate 를 하고 싶다면... 사후 처리로 불르는게 아주 불가능은 아님 https://github.com/pydantic/pydantic-core/issues/1468
    - 열심히 이해해본바, async 로 짜둔 코드를 호출 할 수 는 있다.. 인듯. sync 로 처리 되지 않으려나..? 비협조적인 코드가 될 것 같음. 다시봐도 비협조적으로 작동함 코드 뒤엎지 않아도 된다는 장점만 있는 듯.


## raiflow

riir-airflow 는 Rewrite It In Rust airflow 이다.
it 을 빼보자. Rewrite Ariflow In Rust -> rair-airflow
air 를 굳이 반복할 필요가...? -> rairflow

오.. 나중에 대체 기능 만들 때 훨씬 쉬울 것 같은걸..?

이름은 선점되어 있나??
2024년 10월 19일 기준 아직 아무도 집어가지 않음.

## raiflow.settings

5,6월 달에 열심히 만들어둔 asgi executor 는 완전히 까먹어버렸다.. 못 씀.
pydantic settings 는 덜 까먹겠지...?
